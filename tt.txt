using System.Runtime.InteropServices;
using NAudio.Wave;
using WMPLib;

namespace AudioProApp;

public partial class Form1 : Form
{
    // --- SILNIKI ODTWARZANIA ---

    private readonly string _wavPath = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "test.wav");
    private readonly string _mp3Path = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "test.mp3");

    
    // 1. PlaySound (WinAPI)
    [DllImport("winmm.dll", CharSet = CharSet.Auto)]
    static extern bool PlaySound(string? pszSound, IntPtr hmod, uint fdwSound);

    // 2. ActiveX (WMP)
    WindowsMediaPlayer wmp = new WindowsMediaPlayer();

    // 3. NAudio
    IWavePlayer waveOut = new WaveOutEvent();
    AudioFileReader? audioReader;

    public Form1()
    {
        // Ustawienia okna
        this.Text = "Multi-Audio Player .NET 10";
        this.Size = new Size(500, 450);
        this.Font = new Font("Segoe UI", 10);

        InitializeLayout();
    }

    private void InitializeLayout()
    {
        int startY = 20;

        // --- RZĄD 1: PlaySound (Najprostszy) ---
        AddLabel("Model 1: PlaySound (Tylko WAV)", startY);
        Button btnPlaySound = CreateButton("Graj WAV", startY + 30, 20);
        btnPlaySound.Click += (s, e) => PlaySound(_wavPath, IntPtr.Zero, 0x0001 | 0x0002);
        
        Button btnStopSound = CreateButton("Stop", startY + 30, 130);
        btnStopSound.Click += (s, e) => PlaySound(null, IntPtr.Zero, 0);

        // --- RZĄD 2: ActiveX (WMP - Średniozaawansowany) ---
        startY += 100;
        AddLabel("Model 2: ActiveX (MP3, Szybkość)", startY);
        Button btnWmpPlay = CreateButton("Graj MP3", startY + 30, 20);
        btnWmpPlay.Click += (s, e) => {
            wmp.URL = _mp3Path;
            wmp.controls.play();
        };

        Button btnWmpSlow = CreateButton("Wolno (0.5x)", startY + 30, 130);
        btnWmpSlow.Click += (s, e) => wmp.settings.rate = 0.5;

        Button btnWmpFast = CreateButton("Szybko (2.0x)", startY + 30, 240);
        btnWmpFast.Click += (s, e) => wmp.settings.rate = 2.0;

        Button btnWmpStop = CreateButton("Stop", startY + 30, 350);
        btnWmpStop.Click += (s, e) => wmp.controls.stop();

        // --- RZĄD 3: NAudio (Nowoczesny - Pełna kontrola) ---
        startY += 100;
        AddLabel("Model 3: NAudio (Strumieniowanie)", startY);
        Button btnNaudioPlay = CreateButton("Graj MP3", startY + 30, 20);
        btnNaudioPlay.Click += (s, e) => {
            if (audioReader != null) audioReader.Dispose();
            audioReader = new AudioFileReader(@"C:\test.mp3");
            waveOut.Init(audioReader);
            waveOut.Play();
        };

        Button btnNaudioPause = CreateButton("Pauza", startY + 30, 130);
        btnNaudioPause.Click += (s, e) => waveOut.Pause();

        TrackBar volSlider = new TrackBar { Left = 240, Top = startY + 30, Width = 150, Minimum = 0, Maximum = 100, Value = 50 };
        volSlider.Scroll += (s, e) => { if (audioReader != null) audioReader.Volume = volSlider.Value / 100f; };
        this.Controls.Add(volSlider);
        AddLabel("Głośność", startY + 60, 280, 8);
    }

    // --- POMOCNICZE METODY DO UI ---

    private Button CreateButton(string text, int top, int left)
    {
        Button btn = new Button { Text = text, Top = top, Left = left, Width = 100, Height = 35 };
        this.Controls.Add(btn);
        return btn;
    }

    private void AddLabel(string text, int top, int left = 20, int size = 10)
    {
        Label lbl = new Label { Text = text, Top = top, Left = left, AutoSize = true, Font = new Font("Segoe UI", size, FontStyle.Bold) };
        this.Controls.Add(lbl);
    }
}